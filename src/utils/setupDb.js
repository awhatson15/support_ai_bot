// src/utils/setupDb.js
require('dotenv').config();
const { db, initializeDb } = require('../models/database');
const { addFaq } = require('../models/faqModel');
const logger = require('./logger');

// Начальные FAQ для заполнения базы
const initialFaqs = [
  {
    question: 'Как сбросить пароль аккаунта?',
    answer: 'Для сброса пароля перейдите на страницу входа и нажмите "Забыли пароль?". Следуйте инструкциям, отправленным на вашу электронную почту.',
    keywords: 'пароль, забыл пароль, сброс пароля, восстановление',
    category: 'Аккаунты и безопасность'
  },
  {
    question: 'Как связаться с поддержкой?',
    answer: 'Вы можете связаться с поддержкой через этого бота, по электронной почте support@company.com или по телефону +7 (123) 456-78-90 в рабочие дни с 9:00 до 18:00.',
    keywords: 'поддержка, связаться, контакты, телефон',
    category: 'Общие вопросы'
  },
  {
    question: 'Какие тарифы вы предлагаете?',
    answer: 'Мы предлагаем несколько тарифных планов: Базовый (1000 руб/мес), Стандартный (2500 руб/мес) и Премиум (5000 руб/мес). Подробную информацию можно найти на нашем сайте в разделе "Тарифы".',
    keywords: 'тарифы, цены, стоимость, план',
    category: 'Оплата и тарифы'
  },
  {
    question: 'Как установить приложение?',
    answer: 'Для установки приложения перейдите в App Store или Google Play, найдите наше приложение по названию и нажмите "Установить". После загрузки откройте приложение и следуйте инструкциям по настройке.',
    keywords: 'установка, скачать, приложение, инсталляция',
    category: 'Установка и настройка'
  },
  {
    question: 'Что делать, если приложение вылетает?',
    answer: 'Если приложение вылетает, попробуйте следующие шаги: 1) Перезапустите приложение; 2) Перезагрузите устройство; 3) Убедитесь, что у вас установлена последняя версия; 4) Проверьте свободное место на устройстве; 5) Переустановите приложение.',
    keywords: 'вылетает, крашится, не работает, ошибка',
    category: 'Технические проблемы'
  }
];

// Функция для настройки начальной базы данных
async function setupDatabase() {
  logger.info('Starting database setup...');
  
  // Инициализируем базу данных
  initializeDb();
  
  // Добавляем начальные FAQ
  logger.info('Adding initial FAQs...');
  
  for (const faq of initialFaqs) {
    try {
      await addFaq(faq);
      logger.info(`Added FAQ: ${faq.question}`);
    } catch (error) {
      logger.error(`Error adding FAQ "${faq.question}": ${error.message}`);
    }
  }
  
  logger.info('Database setup completed!');
  process.exit(0);
}

// Запускаем настройку
setupDatabase();
